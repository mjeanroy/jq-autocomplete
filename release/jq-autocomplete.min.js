/*! jq-autocomplete 2013-12-08 */
!function(a,b){"use strict";!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var c="fixed",d="type",e="title",f=function(a){return a},g=function(){},h=function(){return!0},i=".jqauto",j="jqAutoComplete",k=13,l=40,m=38,n=9,o="jq-autocomplete-",p=o+"item",q=o+"item-active",r=o+"results",s=o+"results-list",t=o+"create-link",u=o+"create-form",v=o+"create-form-buttons",w=function(a,c){if(!a||!c)return a;for(var d=c.split("."),e=a,f=d.length,g=0;f-1>g;++g)if(e=e[d[g]],null===e||e===b)return"";return e[d[f-1]]},x=function(a,c){var d=a.attr("data-"+c);return""===d&&(d=b),d},y=function(a){return parseInt(a,10)},z=function(b,c){var d=this;d.$input=a(c),d.opts=a.extend({},b,d.readDatas()),d.caches={},d.filter="",d.results=[],d.idx=-1,d.top=-1,d.left=-1,d.width=-1,d.timer=null,d.xhr=null};z.prototype={init:function(){var b=this;b.$ul=a("<ul></ul>").addClass(s);var d=b.opts.relativeTo,e=c,f=!(d!==c);if(!f){var g=d?a(d):b.$input.parent();g.css("position","relative"),e="absolute"}b.position=e,b.fixed=f,b.$results=a("<div></div>").addClass(r).append(b.$ul),b.opts.$createForm&&b.appendForm(),b.$input.after(b.$results),b.positionResult(),b.bind()},appendForm:function(){var b=this,c=b.$results,f=b.opts.createLabel;f&&(b.$link=a("<a></a>").attr("href","#").addClass(t).html(f).prependTo(c)),b.$form=a(b.opts.$createForm).clone().addClass(u).appendTo(c);var g=b.opts.submit,h=b.opts.cancel;if(g||h){var i=a("<div></div>").addClass(v).appendTo(b.$form);g&&a("<button></button>").attr(d,"submit").attr(e,g).addClass("btn").addClass("btn-success").html(g).appendTo(i),h&&(b.$cancel=a("<button></button>").attr(d,"button").attr(e,h).addClass("btn").addClass("btn-default").html(h).appendTo(i))}},readDatas:function(){var a={},c=this.$input;return a.minSize=x(c,"min-size"),a.limit=x(c,"limit"),a.url=x(c,"url"),a.saveUrl=x(c,"save-url"),a.saveMethod=x(c,"save-method"),a.saveDataType=x(c,"save-data-type"),a.$createForm=x(c,"create-form"),a.createLabel=x(c,"create-label"),a.cancel=x(c,"Cancel"),a.submit=x(c,"Submit"),a.method=x(c,"method"),a.limitName=x(c,"limit-name"),a.filterName=x(c,"filter-name"),a.label=x(c,"label"),a.cache=x(c,"cache")||!1,a.relativeTo=x(c,"relative-to"),a.minSize!==b&&(a.minSize=y(a.minSize)),a.limit!==b&&(a.limit=y(a.limit)),"string"==typeof a.cache&&(a.cache=!("true"!==a.cache)),a},positionResult:function(){var a=this,b=a.$input,c=a.fixed?b.offset():b.position(),d=b.outerWidth(),e=b.outerHeight(),f=c.left,g=c.top+e;(a.left!==f||a.top!==g||a.width!==d)&&(a.left=f,a.top=g,a.width=d,a.$results.css({position:a.position,left:f,top:g,width:d}))},bind:function(){var b=this;b.$input.on("keyup"+i,function(c){var d=c.keyCode;if(d!==k&&d!==l&&d!==m){var e=a.trim(a(this).val());e.length>=b.opts.minSize?b.fetch(e):(b.filter=e,b.$hide(),b.clear())}});var c=function(a,b){a.preventDefault(),a.stopPropagation(),b&&a.stopImmediatePropagation()};b.$input.on("keydown"+i,function(d){var e=d.keyCode;e===l?(c(d),b.highlight(b.idx+1)):e===m?(c(d),b.highlight(b.idx-1)):e===k?b.idx>=0&&b.idx<b.results.length&&(c(d,!0),b.select(b.idx),a(this).focus()):e===n&&b.select(b.idx)}),b.$input.on("focusout"+i,function(){b.focus=!1;var c=a(this);setTimeout(function(){b.focus||b.$creation||!b.$ul||(b.$hide(),b.item||b.autoSelect(a.trim(c.val())),b.opts.focusout.call(b,b.item))},200)}),b.$input.on("focusin"+i,function(){b.focus=!0,!b.item&&b.results.length>0&&b.$show()}),b.$ul.on("mouseenter"+i,function(){a(this).find("li").removeClass(q)}),b.$ul.on("click"+i,"li",function(){b.select(y(a(this).attr("data-idx"))),b.$input.focus()}),b.bindForm()},bindForm:function(){var a=this;a.$link&&a.$link.on("click"+i,function(b){b.preventDefault(),a.showCreationForm()}),a.$cancel&&a.$cancel.on("click"+i,function(){a.hideCreationForm()}),a.$form&&a.$form.on("submit"+i,function(b){b.preventDefault(),a.create()})},isEmpty:function(){return this.item===b||null===this.item},fetch:function(b){var c=this;if(c.filter===b)return c.isEmpty()&&c.$show(),void 0;c.isEmpty()||c.opts.unSelect.call(c),c.item=null,c.filter=b,c.xhr&&(c.xhr.abort(),c.xhr=null),c.timer&&(clearTimeout(c.timer),c.timer=null);var d=b.toLowerCase();if(c.opts.cache&&c.caches[d])c.show(c.caches[d]);else{var e=function(){var b={};b[c.opts.filterName]=c.filter,c.opts.limit>0&&(b[c.opts.limitName]=c.opts.limit),c.opts.datas&&("object"==typeof c.opts.datas?b=a.extend(b,c.opts.datas):"function"==typeof c.opts.datas&&(b=a.extend(b,c.opts.datas.apply(c)))),c.xhr=a.ajax({url:c.opts.url,type:c.opts.method,dataType:"json",data:b}),c.xhr.done(function(a){c.timer=null,c.xhr=null,c.opts.cache&&(c.caches[d]=a),c.show(a)})};c.timer=setTimeout(e,200)}},clearCache:function(){this.caches={}},show:function(b){var c=this;if(c.results=b,0===b.length&&!c.$form)return c.clear(),void 0;c.$hide(),c.$ul.empty();for(var d=0,f=b.length;f>d;++d){var g=c.renderItem(b[d]);a("<li />").addClass(p).attr("data-idx",d).attr(e,g).html(g).appendTo(c.$ul)}c.$show()},hide:function(){this.$hide()},$show:function(){this.positionResult(),this.$results.show(),this.opts.onShown.call(this)},$hide:function(){this.$results.hide(),this.hideCreationForm(),this.opts.onHidden.call(this)},showCreationForm:function(){var a=this;a.$form&&!a.$creation&&(a.$creation=!0,a.$ul.fadeOut("fast",function(){a.$link&&a.$link.hide(),a.$form.show(),a.$form.find('input[type="text"]').eq(0).val(a.$input.val()).focus()}))},hideCreationForm:function(){var a=this;a.$form&&a.$creation&&(a.$creation=!1,a.$form.fadeOut("fast",function(){a.$link&&a.$link.show(),a.$ul.show(),a.$input.focus()}))},create:function(){var c=this;if(c.$creation&&!c.$saving){c.$saving=!0;var d=c.$form.serializeArray(),e={};if(a.each(d,function(){e[this.name]!==b?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),!c.opts.isValid(e,c.$form))return c.$saving=!1,void 0;e=a.extend(e,c.opts.onSaved(e)||{});var f=c.opts.saveUrl||c.$form.attr("action")||c.opts.url,g=c.opts.saveMethod||c.$form.attr("method"),h=c.opts.saveDataType,i=a.ajax({url:f,type:g,dataType:h,data:e});i.done(function(a){c.opts.onSavedSuccess.apply(null,arguments),c.val(a),c.$hide()}),i.fail(function(){c.opts.onSavedFailed.apply(null,arguments)}),i.always(function(){c.$saving=!1})}},val:function(a){var b=this;b.item=a,b.filter=b.renderItem(a),b.$input.val(b.filter),b.$hide(),b.idx=-1,b.opts.select.call(b,a)},renderItem:function(c){var d=this.opts.label,e=a.isFunction(d)?d.call(null,c):w(c,d);return(e===b||null===e)&&(e=""),e},select:function(a){a>=0&&a<this.results.length&&this.val(this.results[a])},autoSelect:function(a){for(var b=this.results,c=a.toLowerCase(),d=0,e=b.length;e>d;++d){var f=this.renderItem(b[d]).toLowerCase();if(f===c)return this.select(d),void 0}},highlight:function(a){var b=this,c=b.results.length;c&&(0>a?a=c-1:a>=c&&(a=0),b.$ul.find("li").removeClass(q).eq(a).addClass(q),b.idx=a)},clear:function(){var a=this;a.item!==b&&null!==a.item&&this.opts.unSelect.call(a),a.$hide(),a.$ul.empty(),a.results=[],a.idx=-1,a.item=null},empty:function(){this.clear(),this.$input.val(""),this.resetForm()},resetForm:function(){this.$form&&this.$form.find('input[type!="hidden"], select').each(function(){a(this).val("")})},unbind:function(){this.$input.off(i),this.$ul.off(i),this.unbindForm()},unbindForm:function(){var a=this;a.$form&&a.$form.off(i),a.$cancel&&a.$cancel.off(i),a.$link&&a.$link.off(i)},destroy:function(){var a=this;a.opts.onDestroyed.call(a),a.unbind(),a.$ul.remove(),a.timer&&clearTimeout(a.timer),a.xhr&&a.xhr.abort();for(var b in a)a.hasOwnProperty(b)&&(a[b]=null)}},a.fn.jqAutoComplete=function(b){var c=this,d=a(this);return c.destroy=function(){d.data(j).destroy(),d.removeData(j)},c.clear=function(){return d.data(j).clear(),c},c.empty=function(){return d.data(j).empty(),c},c.val=function(a){var b=d.data(j);return a?(b.val(a),c):b.item},c.hide=function(){d.data(j).hide()},c.show=function(a){d.data(j).show(a)},c.clearCache=function(){return d.data(j).clearCache(),c},c.each(function(){var c=a(this).data(j);if(!c){var d=a.extend({},a.fn.jqAutoComplete.options);"object"==typeof b&&(d=a.extend(d,b)),c=new z(d,this),c.init()}a(this).data(j,c)})},a.fn.jqAutoComplete.options={url:"",saveUrl:"",label:f,minSize:3,method:"GET",saveMethod:"",saveDataType:"json",filterName:"filter",limitName:"limit",limit:10,datas:null,cache:!1,$createForm:null,createLabel:"Not here? Create it!",cancel:"Cancel",submit:"Save",onSaved:f,onSavedSuccess:g,onSavedFailed:g,isValid:h,relativeTo:null,focusout:g,select:g,unSelect:g,onShown:g,onHidden:g,onDestroyed:g}})}(window,void 0);